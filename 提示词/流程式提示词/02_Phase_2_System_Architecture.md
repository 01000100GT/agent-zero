# 流程化提示词：阶段2 - 系统架构与技术设计

**目标**: 基于产品需求，设计一个健壮、可扩展、可维护的系统架构，并为关键技术挑战制定解决方案。

**作为首席架构师/技术负责人，请引导团队完成以下设计工作，并生成一份详尽的《系统设计文档 (SDD)》。**

---

### 1. 确立架构原则 (Establish Architectural Principles)

*   定义指导我们技术决策的核心原则。这些原则是架构的基石。
    *   *示例：“优先选择成熟且社区活跃的技术”、“设计应是无状态的，易于水平扩展”、“所有服务间通信必须通过API进行”、“安全是设计的第一要素”。*
    *   ***针对智能体项目提示***: *可引入《多智能体服务系统产品需求文档》中提到的“7层事件驱动架构”作为核心原则，确保各层职责清晰、通过消息队列解耦。*

### 2. 质量属性权衡 (Quality Attribute Trade-offs)

*   识别并排序本项目最重要的 **质量属性 (非功能性需求)**。请从以下列表中选择并排序，并说明理由：
    *   **性能 (Performance):** 响应时间、吞吐量
    *   **安全性 (Security):** 防攻击、数据保护
    *   **可扩展性 (Scalability):** 系统应对负载增长的能力
    *   **可维护性 (Maintainability):** 代码的可读性、可修改性
    *   **可靠性 (Reliability):** 系统稳定运行、故障恢复能力
    *   **成本效益 (Cost-Effectiveness):** 开发和运维成本
*   明确阐述在设计中为了某个属性（如极致性能）而可能牺牲另一个属性（如开发速度）的决策和理由。

### 3. 高阶架构设计 (High-Level Architecture)

*   **架构风格选择:** 根据项目类型和质量属性，选择合适的架构风格，并说明原因。
    *   **后端:** 单体 / 微服务 / Serverless / 事件驱动 / 六边形架构
    *   **前端:** SPA / MPA / SSR / SSG / 微前端
    *   **AI项目:** Lambda架构 / Kappa架构 / 模型-服务分离架构
*   **架构可视化:** 使用 **C4 模型** (或类似方法) 绘制系统上下文图 (Context) 和容器图 (Container)，清晰地展示系统的边界和主要组成部分。
*   **技术选型:** 确定核心技术栈，并为每个选型提供充分依据（如POC验证结果、社区成熟度、团队熟悉度、性能对比等）。
    *   *参考附录中的具体技术栈分析模板。*

### 4. 模块化与接口设计 (Modularization & Interface Design)

*   **模块划分:** 将系统划分为高内聚、低耦合的模块/服务。对于微服务架构，定义清晰的领域边界 (Bounded Context)。
*   **接口定义:** 定义模块/服务间的通信协议和API接口。使用 **OpenAPI/Swagger (RESTful)**, **gRPC (RPC)**, 或 **GraphQL** 进行精确定义。
*   **数据模型:** 设计核心的数据模型和数据库表结构（ER图）。

### 5. 关键机制设计 (Design of Critical Mechanisms)

*   针对系统的复杂部分进行深度设计，输出详细方案。常见机制包括：
    *   **认证与授权:** JWT / OAuth2 / RBAC权限模型
    *   **分布式事务:** Saga / TCC / 2PC 模式选择与设计
    *   **缓存策略:** 多级缓存设计（本地、分布式、CDN）
    *   **数据一致性:** 最终一致性方案设计
    *   **AI Agent逻辑流:** 状态机、决策树、提示词管理系统
    *   **数据管道 (AI项目):** ETL/ELT流程，特征存储 (Feature Store)
    *   ***针对智能体项目提示***: *需要特别设计《多智能体服务系统产品需求文档》中提到的关键机制，例如：*
        *   ***严格的9层代码编辑验证机制***: *如何对AI生成的代码进行从语法、类型到安全、性能的全方位验证？*
        *   ***强制文件状态追踪***: *如何设计机制确保Agent决策时获取的是最新的文件状态，避免基于过时信息产生错误操作？*

### 6. 技术风险评估 (Assess Technical Risks)

*   识别潜在的技术风险（如：性能瓶颈、第三方服务依赖、新技术引入的不确定性），并为每个风险制定缓解计划 (Mitigation Plan)。

---

**反思与决策检查点**: 

1.  当前架构是否能灵活支撑未来2-3年的产品路线图？
2.  我们是否对最复杂的技术挑战有了清晰、可行的解决方案？
3.  技术选型是否经过了充分的调研和验证，而非盲目追随潮流？

**交付物**: 

请根据以上设计，并参考附录中的模板，生成一份Markdown格式的《系统设计文档 (SDD)》。

---

## 附录：特定领域架构分析模板

*请根据你的项目类型（可多选），在SDD中详细阐述对应模块。*

### A. 后端项目架构分析

*   **分层设计:** 表现层/业务层/数据层/基础设施层职责划分。
*   **数据架构:** 数据库选型、分库分表策略、读写分离方案。
*   **API治理:** API网关设计（路由、认证、限流、熔断）。
*   **安全体系:** 身份认证、权限模型、数据加密、应用安全防护。
*   **性能优化:** 异步处理、缓存策略、数据库优化、并发模型。
*   **微服务治理 (如适用):** 服务发现、配置管理、熔断降级、分布式事务。

### B. 前端项目架构分析

*   **应用架构:** 路由策略、状态管理方案、组件化架构。
*   **用户体验架构:** 设计系统、响应式设计、国际化、无障碍。
*   **性能优化:** 渲染性能 (Core Web Vitals)、加载优化（代码分割、资源压缩、缓存）。
*   **工程化:** 开发环境、CI/CD、代码规范、测试体系。
*   **安全保障:** XSS/CSRF防护、依赖安全、认证管理。

### C. AI项目架构分析

*   **模型架构:** 模型类型（如Transformer/CNN）、架构创新、模型规模。
*   **数据工程:** 数据管道、特征工程、数据存储（如向量数据库）。
*   **模型开发:** 训练范式、分布式训练、模型优化（量化、剪枝）。
*   **实验管理:** 实验跟踪、A/B测试、评估体系。
*   **模型部署 (MLOps):** 推理优化、服务架构、CI/CD for ML。
*   **AI安全与伦理:** 对抗攻击防护、隐私保护、偏见缓解。